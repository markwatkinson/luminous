<COMMENT>#!/bin/bash</COMMENT>


<KEYWORD>function</KEYWORD> encode {
    
  <KEYWORD>if</KEYWORD> <KEYWORD>[</KEYWORD><KEYWORD>[</KEYWORD> <KEYWORD>$(</KEYWORD><FUNCTION>file</FUNCTION> <STRING>"<VARIABLE>$1</VARIABLE>"</STRING><KEYWORD>)</KEYWORD> =~ <STRING>"FLAC audio bitstream data"</STRING> <KEYWORD>]</KEYWORD><KEYWORD>]</KEYWORD>; <KEYWORD>then</KEYWORD>

      <VARIABLE>OUTF</VARIABLE>=<KEYWORD>`</KEYWORD><FUNCTION>echo</FUNCTION> <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | <FUNCTION>sed</FUNCTION> s/\.flac$/.mp3/g<KEYWORD>`</KEYWORD>

      <VARIABLE>ARTIST</VARIABLE>=<KEYWORD>`</KEYWORD>metaflac <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> --show-tag=<CONSTANT>ARTIST</CONSTANT> | <FUNCTION>sed</FUNCTION> s/.*=//g<KEYWORD>`</KEYWORD>
      <VARIABLE>TITLE</VARIABLE>=<KEYWORD>`</KEYWORD>metaflac <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> --show-tag=<CONSTANT>TITLE</CONSTANT> | <FUNCTION>sed</FUNCTION> s/.*=//g<KEYWORD>`</KEYWORD>
      <VARIABLE>ALBUM</VARIABLE>=<KEYWORD>`</KEYWORD>metaflac <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> --show-tag=<CONSTANT>ALBUM</CONSTANT> | <FUNCTION>sed</FUNCTION> s/.*=//g<KEYWORD>`</KEYWORD>
      <VARIABLE>GENRE</VARIABLE>=<KEYWORD>`</KEYWORD>metaflac <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> --show-tag=<CONSTANT>GENRE</CONSTANT> | <FUNCTION>sed</FUNCTION> s/.*=//g<KEYWORD>`</KEYWORD>
      <VARIABLE>TRACKNUMBER</VARIABLE>=<KEYWORD>`</KEYWORD>metaflac <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> --show-tag=<CONSTANT>TRACKNUMBER</CONSTANT> | <FUNCTION>sed</FUNCTION> s/.*=//g<KEYWORD>`</KEYWORD>
      <VARIABLE>DATE</VARIABLE>=<KEYWORD>`</KEYWORD>metaflac <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> --show-tag=<CONSTANT>DATE</CONSTANT> | <FUNCTION>sed</FUNCTION> s/.*=//g<KEYWORD>`</KEYWORD>

      flac -c -d <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | lame --abr 128 -s 44.1 - <STRING>"<VARIABLE>$OUTF</VARIABLE>"</STRING> --tt <STRING>"<VARIABLE>$TITLE</VARIABLE>"</STRING> --ta <STRING>"<VARIABLE>$ARTIST</VARIABLE>"</STRING> --tl <STRING>"<VARIABLE>$ALBUM</VARIABLE>"</STRING> --ty <STRING>"<VARIABLE>$DATE</VARIABLE>"</STRING> --tg <STRING>"<VARIABLE>$GENRE</VARIABLE>"</STRING> --tn <STRING>"<VARIABLE>$TRACKNUMBER</VARIABLE>"</STRING>

  <KEYWORD>elif</KEYWORD> <KEYWORD>[</KEYWORD><KEYWORD>[</KEYWORD> <KEYWORD>$(</KEYWORD><FUNCTION>file</FUNCTION> <STRING>"<VARIABLE>$1</VARIABLE>"</STRING><KEYWORD>)</KEYWORD> =~ <STRING>"Ogg data, Vorbis audio"</STRING> <KEYWORD>]</KEYWORD><KEYWORD>]</KEYWORD>; <KEYWORD>then</KEYWORD>
      <VARIABLE>OUTF</VARIABLE>=<KEYWORD>`</KEYWORD><FUNCTION>echo</FUNCTION> <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | <FUNCTION>sed</FUNCTION> s/\.ogg$/.mp3/g<KEYWORD>`</KEYWORD>
      <VARIABLE>WAV</VARIABLE>=<KEYWORD>`</KEYWORD><FUNCTION>echo</FUNCTION> <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | <FUNCTION>sed</FUNCTION> s/\.ogg$/.wav/g<KEYWORD>`</KEYWORD>
      <VARIABLE>ALBUM</VARIABLE>=<KEYWORD>`</KEYWORD>ogginfo <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | <FUNCTION>grep</FUNCTION> <CONSTANT>ALBUM</CONSTANT>= | <FUNCTION>sed</FUNCTION> s/.*=//<KEYWORD>`</KEYWORD>
      <VARIABLE>ARTIST</VARIABLE>=<KEYWORD>`</KEYWORD>ogginfo <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | <FUNCTION>grep</FUNCTION> <CONSTANT>ARTIST</CONSTANT>= | <FUNCTION>sed</FUNCTION> s/.*=//<KEYWORD>`</KEYWORD>
      <VARIABLE>DATE</VARIABLE>=<KEYWORD>`</KEYWORD>ogginfo <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | <FUNCTION>grep</FUNCTION> <CONSTANT>DATE</CONSTANT>= | <FUNCTION>sed</FUNCTION> s/.*=//<KEYWORD>`</KEYWORD>
      <VARIABLE>GENRE</VARIABLE>=<KEYWORD>`</KEYWORD>ogginfo <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | <FUNCTION>grep</FUNCTION> <CONSTANT>GENRE</CONSTANT> | <FUNCTION>sed</FUNCTION> s/.*=//<KEYWORD>`</KEYWORD>
      <VARIABLE>TITLE</VARIABLE>=<KEYWORD>`</KEYWORD>ogginfo <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | <FUNCTION>grep</FUNCTION> <CONSTANT>TITLE</CONSTANT>= | <FUNCTION>sed</FUNCTION> s/.*=//<KEYWORD>`</KEYWORD>
      <VARIABLE>TRACKNUMBER</VARIABLE>=<KEYWORD>`</KEYWORD>ogginfo <STRING>"<VARIABLE>$1</VARIABLE>"</STRING> | <FUNCTION>grep</FUNCTION> <CONSTANT>TRACKNUMBER</CONSTANT>= | <FUNCTION>sed</FUNCTION> s/.*=//<KEYWORD>`</KEYWORD>

      oggdec -o <STRING>"<VARIABLE>$WAV</VARIABLE>"</STRING> <STRING>"<VARIABLE>$1</VARIABLE>"</STRING>

      lame --abr 128 -s 44.1 <STRING>"<VARIABLE>$WAV</VARIABLE>"</STRING> <STRING>"<VARIABLE>$OUTF</VARIABLE>"</STRING> --tt <STRING>"<VARIABLE>$TITLE</VARIABLE>"</STRING> --ta <STRING>"<VARIABLE>$ARTIST</VARIABLE>"</STRING> --tl <STRING>"<VARIABLE>$ALBUM</VARIABLE>"</STRING> --ty <STRING>"<VARIABLE>$DATE</VARIABLE>"</STRING> --tg <STRING>"<VARIABLE>$GENRE</VARIABLE>"</STRING> --tn <STRING>"<VARIABLE>$TRACKNUMBER</VARIABLE>"</STRING>
      <FUNCTION>rm</FUNCTION> <STRING>"<VARIABLE>$WAV</VARIABLE>"</STRING>
	 
  <KEYWORD>else</KEYWORD>
    <FUNCTION>echo</FUNCTION> <STRING>"unrecognised file <VARIABLE>$1</VARIABLE>"</STRING>

  <KEYWORD>fi</KEYWORD>
}


<KEYWORD>function</KEYWORD> iter {

<KEYWORD>for</KEYWORD> f <KEYWORD>in</KEYWORD> <KEYWORD>$(</KEYWORD><FUNCTION>ls</FUNCTION> <STRING>"<VARIABLE>$1</VARIABLE>"</STRING><KEYWORD>)</KEYWORD>
<KEYWORD>do</KEYWORD>
  <KEYWORD>if</KEYWORD> <KEYWORD>[</KEYWORD> -d <STRING>"<VARIABLE>$1</VARIABLE>/<VARIABLE>$f</VARIABLE>"</STRING> <KEYWORD>]</KEYWORD>;
  <KEYWORD>then</KEYWORD>
    iter <STRING>"<VARIABLE>$1</VARIABLE>/<VARIABLE>$f</VARIABLE>"</STRING>;
  <KEYWORD>elif</KEYWORD> <KEYWORD>[</KEYWORD> -f <STRING>"<VARIABLE>$1</VARIABLE>/<VARIABLE>$f</VARIABLE>"</STRING> <KEYWORD>]</KEYWORD>; <KEYWORD>then</KEYWORD>
    encode <STRING>"<VARIABLE>$1</VARIABLE>/<VARIABLE>$f</VARIABLE>"</STRING>;
 <KEYWORD>fi</KEYWORD>
<KEYWORD>done</KEYWORD>

}
  
  
  
<VARIABLE>SAVEIFS</VARIABLE>=<VARIABLE>$IFS</VARIABLE>
<VARIABLE>IFS</VARIABLE>=<KEYWORD>$(</KEYWORD><FUNCTION>echo</FUNCTION> -en <STRING>"<ESC>\n</ESC><ESC>\b</ESC>"</STRING><KEYWORD>)</KEYWORD>
<KEYWORD>for</KEYWORD> a <KEYWORD>in</KEYWORD> <STRING>"$@"</STRING>
  <KEYWORD>do</KEYWORD>
    <KEYWORD>if</KEYWORD> <KEYWORD>[</KEYWORD> -d <STRING>"<VARIABLE>$a</VARIABLE>"</STRING> <KEYWORD>]</KEYWORD>; <KEYWORD>then</KEYWORD>
      iter <STRING>"<VARIABLE>$a</VARIABLE>"</STRING>
    <KEYWORD>elif</KEYWORD> <KEYWORD>[</KEYWORD> -f <STRING>"<VARIABLE>$a</VARIABLE>"</STRING> <KEYWORD>]</KEYWORD>; <KEYWORD>then</KEYWORD>
      encode <STRING>"<VARIABLE>$a</VARIABLE>"</STRING>;
    <KEYWORD>fi</KEYWORD>
  <KEYWORD>done</KEYWORD>
<VARIABLE>IFS</VARIABLE>=<VARIABLE>$SAVEIFS</VARIABLE>

  
  
  
